# 식단 추천 시스템을 위한 음식 다중분류모델 개발 

### 음식 메뉴들을 특징에 따라 라벨링 하는 모델 작업 (누비랩 협업)

# 프로젝트 목차 

#### 1. 서론
- 1.1. 주제 선정 이유  
- 1.2. 데이터셋에 대한 설명 

#### 2. 프로젝트 진행 과정 
- 2.1. EDA 
- 2.2. 모델링
- 2.3. 모델링 결과 및 분석 
- 2.4. 그 외 고려했던 모델들  

#### 3. 한계점 및 향후 발전방향 

# 1. 서론 
### 주제 선정 이유

- 누비랩은 현재 제공중인 급식 플랫폼에 추가적으로 식단 추천 시스템을 개발하여 영양사 분들께 제공하고자 합니다. 
- 최근 급식에 나오는 음식들을 추천 시스템에 포함시켜 음식의 트렌드를 식단 구성에 반영할 수 있는 인사이트를 제공하는 게 목표입니다.  
- 이를 위해 새로운 메뉴들을 여러가지 기준에 맞게 라벨링해주는 모델이 필요합니다. 
- 해당 프로젝트에서는 제가 가장 좋아하는 음식 종류인 '고기'를 분류하는 모델을 만들었습니다 (식단 메뉴에 어떤 고기가 들어가는지 분류).   

### 데이터셋에 대한 설명 

- 나이스 교육정보 포털에서 제공되는 공공데이터 (서울시교육청의 급식데이터로 진행)  
- 링크: https://open.neis.go.kr/portal/data/service/selectServicePage.do?page=1&rows=10&sortColumn=&sortDirection=&infId=OPEN17320190722180924242823&infSeq=2
- 고등학교 식단 음식명 추출, 중복 제거

# 2. 프로젝트 진행 과정 
### 2.1. EDA 

- 최종 5.5만개 데이터 사용 
- NEIS 푸드 데이터를 살펴 본 후 각 고기 카테고리에 대한 단어 리스트 구성
- 중복메뉴 제거 (66만개 -> 5.5만개로 축소) 
- Word List: 각 고기 종류에 대한 단어 리스트 구성 
  - 예). 돼지고기: 제육, 돈육, 돈까스 등  
  - 리스트 구성 후 리스트 기반의 데이터 라벨링 진행 (0~5) 

<img width="906" alt="스크린샷 2022-07-13 오후 11 36 09" src="https://user-images.githubusercontent.com/90128775/178760402-e4c9a82e-a128-4fe7-a5e4-83dcf2792653.png">

### 2.2. 모델링 
- #### KoBERT 
  - **`가설`**: 새로운 음식명의 카테고리도 분류할 수 있을 것으로 기대
  - **`특징`**
    - BERT 구조를 따름
    - 이전 문장/단어가 주어지면 다음 문장단어를 예측 
    - 편의성: 토근화 + 다중분류 동시에 진행 가능 
  - **`장점`**: 한국어에 특화된 사전 학습 모델
  - **`분류 기준`**: 고기 분류 5종류 (누비랩 내부 기준에 의거) 
  
### 2.3.모델링 과정 및 결과 (1st case, 2st case로 나눠서 KoBERT 모델 학습 및 결과 도출) 
- 결과 도출 후 모델 성능 확인을 위해 누비랩이 이미 분류작업을 진행한 데이터셋(1855개의 급식메뉴)과 정확도 비교 
- #### 1st Case 
  - 고기 종류 1~5까지 라벨링 된 데이터로 진행 (고기가 없는 경우인 라벨 0 제외)
  - 라벨 0은 고기가 아닌 카테고리  
  - 총 데이터 수 ~ 1만개
  - **`결과물`**: 메뉴 이름을 넣으면 메뉴 이름 입력 시 고기 종류 반환 
  - **`문제`**: 0으로 분류돼야 하는 ‘고기가 아닌 메뉴’들도 고기로 분류 
  - Epoch 5 기준 **`train acc.`** = 0.999, **`test acc.`** = 0.998 

- #### 2nd Case 
  - 고기 종류 0~5까지 라벨링 된 데이터 (중복제거 O, 증폭 X, 5.5만개 중 1만개 샘플링)
  - 증폭(Class Imbalance 해결) 을 했을 때도 결과는 크게 다르지 않았음  
  - Epoch 4 기준 **`train acc.`** = 0.999, **`test acc.`** = 0.998 
  - **`Predict()`** 함수 선언 
    - 모델에 메뉴 입력 -> 라벨링 결과 출력 
  - **`Predict()`** 함수를 통해 'Nuvi_Foods' 데이터와 결과 비교  (595/1855 가 고기에 대해 라벨링 완료)
    - 'Nuvi_Foods' 데이터는 누비랩에서 이미 기업협업 전에 카테고리에 맞게 분류를 해둔 1855개의 데이터셋
    - 단어 리스트에 이미 있는 단어들은 라벨링이 되었음 
    - 리스트에 없는 단어들 → 0 으로 라벨링(분류가 안 됨) 
    - ‘정답'인 누비푸드 데이터에 비해서는 아쉬운 성능 

<img width="589" alt="스크린샷 2022-07-14 오전 12 32 45" src="https://user-images.githubusercontent.com/90128775/178773074-480282e5-4b9d-4ca2-aa59-6739119512a2.png">

- 결론을 내리자면 KoBERT 모델은 음식 메뉴의 특성을 학습하기에는 적합한 모델은 아니라는 판단 
- 단어 리스트에 있는 메뉴들에 대한 분류는 쉽게 이루어지나, 모델을 통해 리스트에 없는, 새로운 메뉴에 대해서 분류를 실행했을 때 정상적으로 이루어지지 않음 

<img width="652" alt="스크린샷 2022-07-14 오전 1 09 52" src="https://user-images.githubusercontent.com/90128775/178780814-f3d9d226-ce43-4896-8c2a-1f03133c7758.png">

### 2.4. 고려했던 모델들 
- 시도도 해보고 디버깅도 해보았으나 적용하지 못했던 모델들
- #### Autokeras 
  - **`고려했던 이유`**: AutoML 프로그램. 편의성 UP
  - **`장점`**: 내장된 TextClassfier. 별도의 Tokenization (X)
    - 스스로 신경망 검색 가능 + 텍스트든 이미지든 다양한 형식 처리 가능 
  - **`단점`**: 특수한 데이터나 데이터가 적을 때 성능이 떨어짐 + 한국어 텍스트 분류 불가 

- #### Naive Bayes Classifier 
  - 베이즈 정리에 기반한 분류 기법 (‘과거’ 데이터로 먼저 훈련)
  - **`고려했던 이유`**: 텍스트 분류를 위해 전통적으로 사용되는 분류기 
  - **`장점`**: 구현하기 수월한 편 + 그리 많은 데이터를 필요로 하지 않음  
    - KoNLPy를 통해 토큰화 - 한국어 말뭉치를 제공하는 패키지 
  - **`결과`**: 토큰화까지는 문제가 없었으나 모델에 토큰화 된 데이터를 Train 데이터 지정하는 과정에서 에러 발생 

# 3. 한계점 및 향후 발전방향 

### 한계점 
- 음식 단어들에 대한 특징 학습이 잘 이루어지지 않음; 새로운 메뉴에 대한 분류가 제대로 이루어지지 않음  

### 보완점 
- 단어 리스트 업데이트를 통한 성능 개선 가능: 하지만 근본적인 해결책은 아님 
- KoBERT는 이런 분류 작업에 사용하기에는 너무 복잡한 모델이라는 지적도 존재함 ; KoBERT와는 다르게 ‘음식' 단어 자체에 대해 학습이 더 잘 되는 모델이 있나 확인 필요 
- 상대적으로 간단한 LR 모델 사용?
  - LR의 경우 기본적으로 다중 분류는 불가, 하지만 활성화 함수를 시그모이드로 바꾸면 각 카테고리에 대한 확률을 나타낼 수 있음  

### 개인적인 회고 
- 모델링과 디버깅에 시간을 뺏겨서 원하는 결과물을 도출하는데 어려움이 있었음 
- 접근법: 이 모델, 저 모델을 시도해보기 전에 사전에 사용 가능한 모델들을 검토했으면 좋았을 것 같다 
- 여러가지 모델들을 시도해볼 수 있다는 점에서 분명히 배울 점은 있는 프로젝트라고 생각한다 


